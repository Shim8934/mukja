<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace속성:매퍼파일의 완전한경로.xml는 생략 -->
<!-- ※ ibatis와는 다르게 id값에 .(dot)을 사용 못한다 -->
<mapper namespace="mybatis.MyPage">

 	<!-- 회원정보 -->
 	<select id="getMyInfo" parameterType="java.util.Map" resultType="UsersDTO">   
		select u_nick, username, u_tend, u_tend,u_img from users where username = #{user_id}
	</select>
	
	<!-- 찜 -->
	<select id="getMyJjim" parameterType="java.util.Map" resultType="MyPageDTO">
		select * from MY_STORELIST where user_email= #{user_id}
	</select>	
	<select id="getJjimInfo" parameterType="java.util.Map" resultType="StoreDTO">
     	select * from stores 
    </select>
	<select id="getJjimImgs" parameterType="java.util.Map" resultType="StoreIMGDTO">    	 
		select * from store_file
	</select>
	
	<!-- 리뷰 -->
	<select id="getMyReview" parameterType="java.util.Map" resultType="MyPageDTO">
		SELECT * FROM (SELECT T.*,ROWNUM R FROM (SELECT * FROM storereview WHERE user_email=#{user_id} order by rv_postdate desc)T)where R between #{rvstart} AND #{rvend}	
	</select>
	<select id="getMyReviewPics" parameterType="java.util.Map" resultType="MyPageDTO">
		select * from review_file 		
	</select>
	
	
	<!-- ET-HISTORY --> 

	
	<!-- 
	<select resultType="MyPageDTO" parameterType="java.util.Map" id="getETList">
		SELECT em.er_no,er.username,er_time,er_tend,er_max,em.erjoin_role FROM eattogether_room er JOIN er_members em ON er.er_no = em.er_no WHERE em.username = #{user_id} 
	</select>

	<select resultType="MyPageDTO" parameterType="java.util.Map" id="getETNames"> 
		SELECT er_no,username,erjoin_role FROM er_members where erjoin_role=1 
	</select>
	
	<select resultType="UsersDTO" parameterType="java.util.Map" id="getUsersNks"> 
		select username,u_nick from users 
	</select>
	-->
	
	<select id="getETrecv0" parameterType="java.util.Map" resultType="MyPageDTO"> 
		SELECT er.er_no, er.username, er_time, er_tend, er_max, em.username user_id, em.erjoin_role FROM 
		(SELECT * FROM 
		(SELECT er_no,username,erjoin_role  FROM er_members where username= #{user_id}) 
		where erjoin_role= 0) em join eattogether_room er on em.er_no = er.er_no order by er_postdate desc
	</select>
	<select id="getNicks" parameterType="java.util.Map" resultType="MyPageDTO">
		select em.er_no, u.username, u.u_nick,em.erjoin_role from er_members em join users u on u.username = em.username where em.erjoin_role=1
	</select>
	<select id="getETrecv1" parameterType="java.util.Map" resultType="MyPageDTO">    	 
		SELECT er.er_no, er.username, er.er_time, er.er_tend, er.er_max, em.user_id, em.erjoin_role FROM 
		(SELECT er_no,username user_id,erjoin_role FROM 
		(SELECT * FROM er_members where username= #{user_id}) 
		where erjoin_role= 1) em join eattogether_room er on em.er_no = er.er_no order by er_postdate desc
	</select><!-- 
	<select id="getNicks1" parameterType="java.util.Map" resultType="MyPageDTO">
		select em.er_no, u.username, u.u_nick,em.erjoin_role from er_members em join users u on u.username = em.username where em.erjoin_role=1
	</select> -->
	
	
	<!-- select * from eattogether_room er join er_members em on er.er_no = em.er_no
	join users u on em.username = u.username where u.username=${user_id} 
	 
	-->
	 
	 <select id="getMyJjimTotal" parameterType="java.util.Map" resultType="int">
		select count(*) from my_storelist where user_email = #{user_id}
	</select>
	<select id="getMyReviewTotal" parameterType="java.util.Map" resultType="int">
		select count(*) from storereview where user_email = #{user_id}
	</select>
	
	

</mapper>